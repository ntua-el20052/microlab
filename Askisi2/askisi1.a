.include "m328PBdef.inc"
 
.equ FOSC_MHZ=16	;MHz
.equ DEL_mS=500	;mS
.equ DEL_NU= FOSC_MHZ*DEL_mS  
    
.cseg
    .org 0x00		;Reset vector
    rjmp reset		;Jump to reset handler
    
    .org 0x4		;Start of interrupt vectors
    rjmp ISR1		;Jump to INT1 interrupt handler    
    
    
    
reset:
    ldi r24,low(RAMEND)
    out SPL,r24
    ldi r24,high(RAMEND)
    out SPH,r24  

;init PORTB as output
ser r26
out DDRB, r26

loop1:
    clr r26
loop2:
    out PORTB, r26
    ldi r26, low(DEL_NU)
    ldi r25, high(DEL_NU)
    rcall delay_mS
    
    inc r26
    
    cpi r26, 16
    breq loop1
    rjmp loop2
    
    
    
    
    
    
delay_mS:
    ldi r23, 249
loop_inn:
    dec r23		    ; 1 cycle
    nop			    ; 1 cycle
    brne loop_inn	    ; 1 or 2 cycles
     
    sbiw r24 ,1		    ; 2 cycles
    brne delay_mS	    ; 1 or 2 cycles
 
    ret			    ;4 cycl
    
    
    
ISR1:
    in p7,PIND
    sbrs p7, 6
    rjmp skip2
    inc led
    cpi led, 32
    breq skip
    out PORTC,led
    reti
    skip:
	ldi led,0x00
	reti
    skip2:
	nop
	nop
	reti
